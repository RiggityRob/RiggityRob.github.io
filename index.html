<!DOCTYPE html>
<html>
<title>Rob.Haus</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
<style>
    body, h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif}
    p {color:ghostwhite;}
    .w3-row-padding img {margin-bottom: 12px}
    .w3-sidebar {width: 120px;background: #282155;}
    #main {margin-left: 120px}
    @media only screen and (max-width: 600px) {#main {margin-left: 0}}
</style>
<body background = "grey">
<!-- This is for the website background-->


<!-- Icon Bar (Sidebar - hidden on small screens) -->
<nav class="w3-sidebar w3-bar-block w3-small w3-hide-small w3-center">
    <!-- Avatar image in top left corner -->
    <img src="/Docs/memer2.png" style="width:100%">
    <a href="#" class="w3-bar-item w3-button w3-padding-large w3-black">
        <i class="fa fa-home w3-xxlarge"></i>
        <p>HAUS</p>
    </a>
    <a href="#about" class="w3-bar-item w3-button w3-padding-large w3-hover-black">
        <i class="fa fa-user-circle-o w3-large"></i>
        <p>About Me</p>
    </a>
    <a href="#gallery" class="w3-bar-item w3-button w3-padding-large w3-hover-black">
        <i class="fa fa-file-code-o w3-large"></i>
        <p>Gallery</p>
    </a>
    <a href="#contact" class="w3-bar-item w3-button w3-padding-large w3-hover-black">
        <i class="fa fa-envelope w3-large"></i>
        <p>Contact</p>
    </a>
</nav>

<!-- Navbar on small screens (Hidden on medium and large screens) -->
<div class="w3-top w3-hide-large w3-hide-medium" id="myNavbar">
    <div class="w3-bar w3-black w3-opacity w3-hover-opacity-off w3-center w3-small">
        <a href="#" class="w3-bar-item w3-button" style="width:25% !important">HOME</a>
        <a href="#about" class="w3-bar-item w3-button" style="width:25% !important">ABOUT</a>
        <a href="#gallery" class="w3-bar-item w3-button" style="width:25% !important">GALLERY</a>
        <a href="#contact" class="w3-bar-item w3-button" style="width:25% !important">CONTACT</a>
    </div>
</div>

<!-- Page Content -->
<div class="w3-padding-large" id="main">
    <!-- Header/Home -->
    <header class="w3-container w3-padding-32 w3-center w3-black" id="home">
        <img src="/Docs/memer.png" alt="me" class="image" width="20%" height="20%">
        <h1 class="w3-jumbo"><span class="w3-hide-small"></span> Robert Goodeve</h1>
        <p>Bon Vivant and Programmer Extraordinaire!</p>

    </header>

    <!-- About Section -->
    <div class="w3-content w3-justify w3-text-light-grey w3-padding-64" id="about">
        <h2 class="w3-text-light-grey">About Robert</h2>
        <hr style="width:200px" class="w3-opacity">
        <p>Proficent in Python.

            Currently: at PyCon 2024 and busy with CMU Operations.
            I enjoy music of too many genres, books of the literary variety, and long conversations of any variety.
        </p>
        <h3 class="w3-padding-16 w3-text-light-grey">My Skills</h3>
        <p class="w3-wide">Programming</p>
        <div class="w3-white">
            <div class="w3-dark-grey" style="height:28px;width:92%"></div>
        </div>
        <p class="w3-wide">Web Design</p>
        <div class="w3-white">
            <div class="w3-dark-grey" style="height:28px;width:80%"></div>
        </div>
        <p class="w3-wide">Business</p>
        <div class="w3-white">
            <div class="w3-dark-grey" style="height:28px;width:72%"></div>
        </div>
        <br>

        <form action="https://riggityrob.github.io/Docs/RobertGoodeveResume1.pdf">    
            <button class="w3-button w3-light-grey w3-section">
                <i class="fa fa-download"> Download Resume</i>
            </button>
        </form>
    </div>
</div>

<!-- Portfolio Section -->
<div class="">
    <div class="w3-padding-64 w3-content" id="gallery">
        <h2 class="w3-text-light-grey">My Gallery</h2>
        <hr style="width:200px" class="w3-opacity">

        <!-- Grid for photos -->
        <div class="w3-row-padding" style="margin:0 -16px">
            <!-- change these to canvas elements for small algos-->
            <div class="w3-half">
	       <pre class="prettyprint">
			import glob
			import re
			import requests

			header_for_mp_file = """/DELIMITER="|"
			/DATEFORMAT="YYYY-MM-DD HH24:MI:SS"
			/TABLE_WHERE=<PATRONGROUPS><PATRONID=PIK(2) and GROUPNUMBER=VALUE(10)>"""
			varz = "group_number", "start_date", "expiration_date", "ticket_number"

			#expecting a csv with the header of the format: group #, start date, expiry date, ticket #
			#rows of data under the header should be userid/email/pik (any of 1), first name, middle name, last name 

			# dont leave these here lol
			secrets_server = "???"
			username = "???"

			files = glob.glob("./*.csv")

			for d in files:
			    with open(d) as f, open("Import" + re.sub(r'\W+', '',str(d).split(".csv")[0]) + ".mp", "a") as append_file:
			            error_file = open("errors.txt", "a")
				            two_header_for_mp_file = "/FIELDS=UPDATE_MODE|PRIMARYKEYVALUE|PATRONGROUPS.GROUPNUMBER|","PATRONGROUPS.GROUPEFFECTIVE|","PATRONGROUPS.GROUPEXPIRE|","PATRONGROUPS.THECOMMENT"
					            lines = f.read()
						            try:
							                first_line = lines.split("\n", 1)[0]
									            first_line_dict = dict(zip(list(varz), list(first_line.split(","))))
										                if len(first_line_dict["start_date"]) > 0 and len(first_line_dict["expiration_date"]) > 0:
												                dates = two_header_for_mp_file[1] + two_header_for_mp_file[2]
														            elif len(first_line_dict["start_date"]) > 0:
															                    dates = two_header_for_mp_file[1]
																	                elif len(first_line_dict["expiration_date"]) > 0:
																			                dates = two_header_for_mp_file[2]
																					            else:
																						                    dates = ""
																								                two_header_for_mp_file = two_header_for_mp_file[0]+dates+two_header_for_mp_file[3]
																										            append_file.write(header_for_mp_file + "\n")
																											                append_file.write(two_header_for_mp_file + "\n")
																													        except Exception as e:
																														            error_file.write(
																															                    "\nbadly formatted input file "
																																	                    + re.sub(r'\W+','',str(f).split(",")[0])
																																			                    + " with error "
																																					                    + str(e)
																																							                    + "\n"
																																									                )
																																											            pass
																																												            lines = lines.split("\n")[1:]
																																													            for line in lines:
																																														                andrewid = line.split(",")[0]
																																																            if bool(re.match("[a-z{1,10}]", userid)):
																																																	                    try:
																																																			                        if "@" in andrewid:
																																																						                        userid = userid.split("@")[0]
																																																									                    else:
																																																											                            userid = userid.strip()
																																																														                        url = "https://{}/robhauswebservice/api/excel/pik/{}?username={}".format(
																																																																	                        secrets_server, userid, username
																																																																				                    )
																																																																						                        response = requests.get(get_url)
																																																																									                    out_string = (
																																																																											                            "A|"
																																																																														                            + response
																																																																																	                            + "|"
																																																																																				                            + "|".join(list(filter(None, first_line_dict.values())))
																																																																																							                            + "\n"
																																																																																										                        )
																																																																																													                    append_file.write(out_string)
																																																																																															                    except Exception as e:
																																																																																																	                        error_file.write(" bad user id " + andrewid + ",")
																																																																																																				                    pass
																																																																																																						                elif bool(re.match("[0-9{9}]", andrewid)):
																																																																																																								                response = andrewid
																																																																																																										                out_string = (
																																																																																																												                        "A|"
																																																																																																															                        + response
																																																																																																																		                        + "|"
																																																																																																																					                        + "|".join(list(filter(None, first_line_dict.values())))
																																																																																																																								                        + "\n"
																																																																																																																											                )
																																																																																																																													                append_file.write(out_string)
																																																																																																																															            else:
																																																																																																																																                    error_file.write(" bad user id " + andrewid + ",")
																																																																																																																																		                    pass
																																																																																																																																				            try:
																																																																																																																																					                error_file.write("\n")
																																																																																																																																							            error_file.close()
																																																																																																																																								            except:
																																																																																																																																									                pass

	       </pre>
	    </div>
	    <div class="w3-half">
	   	<pre class="prettyprint">

		</pre>
	    </div>
	    <div class="w3-half">
                <pre class="prettyprint">
		# Import smtplib for the actual sending function
		import smtplib
		import os
		import csv

		# Here are the email package modules we'll need
		from email.mime.text import MIMEText
		from email.mime.multipart import MIMEMultipart
		from email.mime.application import MIMEApplication

		# Create the outer email message.

		sender = '"Gold Team" <gold-help@rob.haus>'
		bcc = "archives@rob.haus"
		cfy = "24"
		nfy = "25"
		ccost = "35"
		ncost = "36.75"
		# Change Percentage - this is not calculated so as to use whatever rounding we decide looks best
		change = "1.05"

		rows = []

		with open("FY" + cfy + "Billing.csv", encoding="utf_8_sig") as csvfile:
		    reader = csv.DictReader(csvfile)
		        for row in reader:
			        rows.append(row)

				e = 1
				for row in rows:
				    # Skip Housing Email
				        # 	if (e == 42):
					    # 		continue
					        to = []
						    erows = dict(row)
						        print(erows)

							    # Append up to three email address contacts to email sending list, comment out until ready for real sending
							        for i in range(2):
								        if f"CONTACT1EMAIL" in erows:
									            email = erows[f"CONTACT{i+1}EMAIL"]
										                name = erows[f"CONTACT{i+1}"]
												            to.append(f'"{name}" <{email}>')
													        dept = erows["DEPARTMENT"]
														    print(dept)
														        deptfilename = f"{dept.replace(': ','-')}.csv"
															    # Override To header for testing
															        # to = ['"Chris Nolin" <cnolin@andrew.cmu.edu>']

																    # Generate EmailGroup/Department CSV
																        with open(deptfilename, "a", newline="") as deptcsvfile:
																	        to = "|".join(to)
																		        deptwriter = csv.DictWriter(
																			            deptcsvfile,
																				                fieldnames=[
																						                "To",
																								                "Location",
																										                "Location Description",
																												                "Extra Description",
																														                "Group",
																																                "Group Description",
																																		                "Oracle Charge String",
																																				            ],
																																					            )
																																						            deptwriter.writerow(
																																							                {
																																									                "To": to,
																																											                "Location": erows["LOCATION"],
																																													                "Location Description": erows["LOCATION_DESCRIPTION"],
																																															                "Extra Description": erows["NODE_DESCRIPTION"],
																																																	                "Group": erows["BILLING_GROUP_NAME"],
																																																			                "Group Description": erows["BILLING_GROUP_DESCRIPTION"],
																																																					                "Oracle Charge String": str(erows["CHARGE_FUNDING_SOURCE"])
																																																							                + str(erows["CHARGE_ACTIVITY"])
																																																									                + str(erows["CHARGE_FUNCTION"])
																																																											                + str(erows["CHARGE_ORG"])
																																																													                + str(erows["CHARGE_ENTITY"]),
																																																															            }
																																																																            )
																																																																	    directory = os.getcwd()

																																																																	    for filename in os.listdir(directory):
																																																																	        if filename.endswith(".csv"):
																																																																		        csv_path = os.path.join(directory, filename)
																																																																			        with open(csv_path, "r") as f:
																																																																				            reader = csv.reader(f)
																																																																					                to = next(reader)[0]
																																																																							            devices = sum(1 for _ in f)
																																																																								            dept = str([filename])
																																																																									            msg = MIMEMultipart("alternative")
																																																																										            msg[
																																																																											                "Subject"
																																																																													        ] = f"{dept} FY{cfy}/{nfy} Charges for Physical Access Devices (CSGold)"
																																																																														        msg["From"] = sender
																																																																															        to = to.split("|")
																																																																																        msg["To"] = ",".join(to)
																																																																																	        with open(csv_path, "r") as f:
																																																																																		            attachment = MIMEApplication(f.read())
																																																																																			                attachment.add_header(
																																																																																					                "Content-Disposition", "text/csv", filename="Billed Locations.csv"
																																																																																							            )
																																																																																								                msg.attach(attachment)

																																																																																										        # textfile='Billing.txt'
																																																																																											        # with open(textfile, 'rb') as fp:
																																																																																												        #    text = fp.read()
																																																																																													        htmlfile = "FY" + cfy + "Billing.html"
																																																																																														        with open(htmlfile, "rb") as fp:
																																																																																															            html = fp.read()

																																																																																																            tablerows = ""

																																																																																																	            html = html.replace(b"{tablerows}", bytes(tablerows, "us-ascii"))
																																																																																																		            html = html.replace(b"{cfy}", bytes(cfy, "us-ascii"))
																																																																																																			            html = html.replace(b"{nfy}", bytes(nfy, "us-ascii"))
																																																																																																				            html = html.replace(b"{ccost}", bytes(ccost, "us-ascii"))
																																																																																																					            html = html.replace(b"{ncost}", bytes(ncost, "us-ascii"))
																																																																																																						            html = html.replace(b"{change}", bytes(change, "us-ascii"))
																																																																																																							            html = html.replace(b"{devices}", bytes(str(devices), "us-ascii"))
																																																																																																								            html = html.replace(
																																																																																																									                b"{ccost*devices}", bytes(str(float(ccost) * devices), "us-ascii")
																																																																																																											        )
																																																																																																												        html = html.replace(
																																																																																																													            b"{ncost*devices}", bytes(str(float(ncost) * devices), "us-ascii")
																																																																																																														            )

																																																																																																															            # msg.attach(MIMEText(text, "plain", 'us-ascii'))
																																																																																																																            msg.attach(MIMEText(html, "html", "us-ascii"))

																																																																																																																	            # Send the email via our own SMTP server.
																																																																																																																		            s = smtplib.SMTP("SECRET")
																																																																																																																			            # The below (usually commented) line is how you override the actual email send.  You can use this to see how every email looks before they actually get sent to customers.
																																																																																																																				            # s.sendmail(sender, "goodeve@rob.haus", msg.as_string())
																																																																																																																					            s.sendmail(sender, to + [bcc], msg.as_string())
																																																																																																																						            s.quit()

		</pre>

            </div>
    
            <div class="w3-half">	
		<pre class="prettyprint">

		</pre>

            </div>
        </div>
        <!-- End Portfolio Section -->
    </div>
</div>

    <!-- Contact Section -->
    <div class="w3-padding-64 w3-content w3-text-grey" id="contact">
        <h2 class="w3-text-light-grey">Contact Me</h2>
        <hr style="width:200px" class="w3-opacity">

        <div class="w3-section">
            <p><i class="fa fa-phone fa-3x w3-text-white w3-xxxlarge w3-margin-right"></i> Phone: +01 813 447 0861</p>
            <p><i class="fa fa-envelope fa-3x w3-text-white w3-xxxlarge w3-margin-right"> </i> Email: goodeve@rob.haus</p>
            <p> <i class="fa fa-linkedin fa-3x w3-hover-opacity w3-xxlarge w3-margin-right">  <a href="https://www.linkedin.com/in/robert-goodeve/" target="_blank" class="w3-hover-text-white"> Connect with me</a> </i></p>
        </div><br>
        <p>Lets get in touch. Send me a message:</p>

        <form method="post" action="/Docs/emailer.py" target="_blank">
            <p><input class="w3-input w3-padding-16" type="text" placeholder="Name" required name="Name"></p>
            <p><input class="w3-input w3-padding-16" type="text" placeholder="Email" required name="Email"></p>
            <p><input class="w3-input w3-padding-16" type="text" placeholder="Subject" required name="Subject"></p>
            <p><input class="w3-input w3-padding-16" type="text" placeholder="Message" required name="Message"></p>
            <p>
                <button class="w3-button w3-light-grey w3-padding-large" type="submit">
                    <i class="fa fa-paper-plane"></i> SEND MESSAGE
                </button>
            </p>
        </form>
        <!-- End Contact Section -->
    </div>

    <!-- Footer -->
    <footer class="w3-content w3-padding-64 w3-text-white w3-xlarge">
        <p class="w3-medium">Powered by w3css, Python, and Git</p>
        <!-- End footer -->
    </footer>

    <!-- END PAGE CONTENT -->
</div>

</body>
</html>
